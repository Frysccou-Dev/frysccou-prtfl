---
import Layout from "../presentation/layouts/Layout.astro";
import Hero from "../presentation/components/marketing/Hero.astro";
import BlogCard from "../presentation/components/marketing/BlogCard.astro";
import ScrollReveal from "../presentation/components/ui/ScrollReveal";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");

const blogMap = new Map();
allPosts.forEach((post) => {
  const parts = post.slug.split("/");
  const seriesSlug = parts[0];
  if (!blogMap.has(seriesSlug)) {
    blogMap.set(seriesSlug, {
      id: seriesSlug,
      slug: seriesSlug,
      title: post.data.blogTitle,
      description: post.data.description,
      date: post.data.date,
      author: post.data.author,
      category: post.data.category,
      chaptersCount: 0,
    });
  }
  blogMap.get(seriesSlug).chaptersCount++;
});

const featuredBlogs = Array.from(blogMap.values()).slice(0, 5);
---

<Layout title="Elegant Minimalist Studio | Blog">
  <Hero />

  <section class="pb-40 border-t border-white/5">
    <div class="max-w-6xl mx-auto px-6 pt-24">
      <div
        class="flex flex-col md:flex-row md:items-baseline justify-between gap-6 mb-24"
      >
        <ScrollReveal client:load direction="right">
          <h2
            class="text-4xl md:text-7xl font-display font-black uppercase tracking-tighter"
          >
            Selected <span class="text-primary italic">Works</span>
          </h2>
        </ScrollReveal>
        <ScrollReveal client:load direction="left">
          <p
            class="text-surface-400 font-bold uppercase tracking-[0.2em] text-[10px]"
          >
            Recent Series
          </p>
        </ScrollReveal>
      </div>

      <div class="flex flex-col">
        {
          featuredBlogs.map((blog, index) => (
            <ScrollReveal client:load delay={index * 0.1}>
              <BlogCard blog={blog} />
            </ScrollReveal>
          ))
        }
      </div>
    </div>
  </section>
</Layout>
