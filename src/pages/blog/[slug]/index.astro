---
import Layout from "../../../presentation/layouts/Layout.astro";
import ScrollReveal from "../../../presentation/components/ui/ScrollReveal";
import { getCollection } from "astro:content";
import { ChevronRight, Layers } from "lucide-react";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const blogSlugs = [
    ...new Set(allPosts.map((post) => post.slug.split("/")[0])),
  ];
  return blogSlugs.map((slug) => ({ params: { slug } }));
}

const { slug } = Astro.params;
const allPosts = await getCollection("blog");
const chapters = allPosts
  .filter((post) => post.slug.startsWith(slug as string))
  .sort((a, b) => a.data.order - b.data.order);

if (chapters.length === 0) return Astro.redirect("/404");

const info = chapters[0].data;
---

<Layout title={`${info.blogTitle} | Series`}>
  <section class="pt-64 pb-40">
    <div class="max-w-6xl mx-auto px-6">
      <ScrollReveal client:load>
        <div class="flex items-center gap-4 mb-8">
          <Layers size={20} class="text-primary" />
          <span
            class="text-xs font-black uppercase tracking-widest text-primary"
            >{info.category} Collection</span
          >
        </div>

        <h1
          class="text-6xl md:text-9xl font-display font-black uppercase tracking-tighter mb-12"
        >
          {info.blogTitle}
        </h1>

        <p
          class="text-2xl text-surface-400 max-w-3xl leading-relaxed mb-32 italic"
        >
          {info.description}
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
          {
            chapters.map((ch, index) => (
              <a
                href={`/blog/${ch.slug}`}
                class="group flex flex-col p-8 glass-card rounded-3xl transition-all duration-500 hover:translate-y-[-10px] hover:border-primary/20"
              >
                <div class="flex items-center justify-between mb-8">
                  <span class="flex items-center justify-center w-12 h-12 bg-white/5 border border-white/10 rounded-2xl text-primary font-black group-hover:bg-primary group-hover:text-black transition-all">
                    {ch.data.order}
                  </span>
                  <ChevronRight
                    size={20}
                    class="text-surface-600 group-hover:text-primary transition-colors"
                  />
                </div>

                <h3 class="text-2xl font-bold mb-4 group-hover:text-white transition-colors">
                  {ch.data.chapterTitle}
                </h3>
                <p class="text-surface-500 text-sm leading-relaxed">
                  {ch.data.description}
                </p>
              </a>
            ))
          }
        </div>
      </ScrollReveal>
    </div>
  </section>
</Layout>
