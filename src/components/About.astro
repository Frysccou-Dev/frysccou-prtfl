---
import { translations } from "../i18n/translations.js";
import { hobbies } from "../i18n/data.js";
import { ChevronRight, ChevronLeft } from "lucide-astro";
const t = translations.en;
const meImages = [
  "/me.png",
  "/me2.jpg",
  "/me3.jpg",
  "/me4.jpg",
  "/mechiquito.jpg",
];
---

<section id="about" class="py-32 relative overflow-hidden">
  <div class="max-w-7xl mx-auto px-6 relative z-10">
    <div class="text-center mb-16 about-header opacity-0 translate-y-10">
      <h2
        class="text-4xl md:text-5xl font-[Outfit] font-bold mb-4 text-text-primary"
        data-i18n="about.title"
      >
        {t.about.title}
      </h2>
      <p class="text-text-muted text-lg italic" data-i18n="about.subtitle">
        {t.about.subtitle}
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-16 items-center">
      <div
        class="about-image opacity-0 -translate-x-10 relative group/carousel"
      >
        <div
          class="aspect-square rounded-3xl bg-gray-50 p-4 relative overflow-hidden border border-gray-100 hover:border-accent transition-all duration-500 hover:shadow-2xl hover:shadow-accent-soft/20"
        >
          <div
            class="relative z-10 h-full w-full overflow-hidden rounded-2xl bg-gray-100"
          >
            {
              meImages.map((src, idx) => (
                <img
                  src={src}
                  alt="Francisco"
                  class="about-carousel-img absolute inset-0 w-full h-full object-cover opacity-0 pointer-events-none"
                  style={idx === 0 ? "opacity: 1; pointer-events: auto;" : ""}
                  data-index={idx}
                />
              ))
            }
          </div>

          <button
            id="prev-image"
            class="absolute left-8 top-1/2 -translate-y-1/2 z-20 w-10 h-10 rounded-full bg-white/80 backdrop-blur-md border border-white/50 flex items-center justify-center text-text-primary opacity-0 group-hover/carousel:opacity-100 transition-all duration-300 hover:bg-accent hover:text-white cursor-pointer pointer-events-auto"
          >
            <ChevronLeft class="w-6 h-6" />
          </button>
          <button
            id="next-image"
            class="absolute right-8 top-1/2 -translate-y-1/2 z-20 w-10 h-10 rounded-full bg-white/80 backdrop-blur-md border border-white/50 flex items-center justify-center text-text-primary opacity-0 group-hover/carousel:opacity-100 transition-all duration-300 hover:bg-accent hover:text-white cursor-pointer pointer-events-auto"
          >
            <ChevronRight class="w-6 h-6" />
          </button>

          <div
            class="absolute bottom-8 left-1/2 -translate-x-1/2 z-20 flex gap-2"
          >
            {
              meImages.map((_, idx) => (
                <div
                  class={`carousel-dot w-2 h-2 rounded-full transition-all duration-300 ${idx === 0 ? "bg-accent w-4" : "bg-white/60"}`}
                  data-index={idx}
                />
              ))
            }
          </div>

          <div
            class="absolute top-4 right-4 w-3 h-3 rounded-full bg-accent animate-pulse z-20"
          >
          </div>
          <div
            class="absolute bottom-12 left-12 w-2 h-2 rounded-full bg-rose-accent animate-pulse z-20"
          >
          </div>
        </div>
      </div>

      <div class="about-text opacity-0 translate-x-10">
        <p
          class="text-text-secondary text-lg leading-relaxed mb-6 font-medium"
          data-i18n="about.description1"
        >
          {t.about.description1}
        </p>
        <p
          class="text-text-secondary text-lg leading-relaxed mb-10"
          data-i18n="about.description2"
        >
          {t.about.description2}
        </p>

        <div class="grid sm:grid-cols-1 gap-6 mb-10">
          <div class="space-y-4">
            <h3
              class="text-xs font-bold uppercase tracking-widest text-accent mb-4"
              data-i18n="about.hobbiesTitle"
            >
              {t.about.hobbiesTitle}
            </h3>
            <ul class="space-y-3">
              <li class="flex items-center gap-3 text-text-secondary text-sm">
                <span class="w-1.5 h-1.5 rounded-full bg-accent"></span>
                <span data-i18n="about.funFact1">{t.about.funFact1}</span>
              </li>
              <li class="flex items-center gap-3 text-text-secondary text-sm">
                <span class="w-1.5 h-1.5 rounded-full bg-rose-accent"></span>
                <span data-i18n="about.funFact2">{t.about.funFact2}</span>
              </li>
              <li class="flex items-center gap-3 text-text-secondary text-sm">
                <span class="w-1.5 h-1.5 rounded-full bg-accent"></span>
                <span data-i18n="about.funFact3">{t.about.funFact3}</span>
              </li>
            </ul>
          </div>
        </div>

        <div class="flex flex-wrap gap-2">
          {
            hobbies.map((hobby) => (
              <span class="hobby-tag px-4 py-1.5 bg-white rounded-full border border-gray-100 text-text-secondary text-xs font-bold flex items-center gap-2 hover:border-accent hover:bg-accent-soft/30 hover:shadow-sm transition-all duration-300 cursor-default">
                <span>{hobby.icon}</span>
                <span data-i18n={`hobbies.${hobby.key}`}>
                  {t.hobbies[hobby.key as keyof typeof t.hobbies]}
                </span>
              </span>
            ))
          }
        </div>

        <div class="mt-8 github-stats opacity-0 translate-y-4">
          <div
            class="p-0.5 bg-linear-to-r from-accent/20 to-rose-accent/20 rounded-4xl"
          >
            <div
              class="bg-white/80 backdrop-blur-sm rounded-[1.85rem] p-4 md:p-6 border border-white hover:border-accent transition-all duration-500 shadow-sm hover:shadow-xl hover:shadow-accent/5 group"
            >
              <img
                src="https://ghchart.rshah.org/7c3aed/esspindola"
                alt="GitHub Contributions Graph"
                class="w-full h-auto rounded-xl transition-all duration-700 group-hover:scale-[1.02] opacity-90 group-hover:opacity-100"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", () => {
    const images = document.querySelectorAll(".about-carousel-img");
    const dots = document.querySelectorAll(".carousel-dot");
    const prevBtn = document.getElementById("prev-image");
    const nextBtn = document.getElementById("next-image");

    let currentIndex = 0;
    const totalImages = images.length;

    if (totalImages === 0) return;

    function showImage(index: number) {
      if (index === currentIndex) return;

      const currentImg = images[currentIndex] as HTMLElement;
      const nextImg = images[index] as HTMLElement;

      dots[currentIndex].classList.remove("bg-accent", "w-4");
      dots[currentIndex].classList.add("bg-white/60");
      dots[index].classList.add("bg-accent", "w-4");
      dots[index].classList.remove("bg-white/60");

      gsap.to(currentImg, {
        opacity: 0,
        scale: 1.05,
        duration: 0.8,
        ease: "power2.inOut",
        onComplete: () => {
          currentImg.style.pointerEvents = "none";
        },
      });

      gsap.fromTo(
        nextImg,
        { opacity: 0, scale: 0.95 },
        {
          opacity: 1,
          scale: 1,
          duration: 0.8,
          ease: "power2.out",
          onStart: () => {
            nextImg.style.pointerEvents = "auto";
          },
        },
      );

      currentIndex = index;
    }

    const carouselContainer = document.querySelector(".about-image div");
    let touchStartX = 0;
    let touchEndX = 0;

    carouselContainer?.addEventListener(
      "touchstart",
      (e: any) => {
        touchStartX = e.changedTouches[0].screenX;
      },
      { passive: true },
    );

    carouselContainer?.addEventListener(
      "touchend",
      (e: any) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      },
      { passive: true },
    );

    function handleSwipe() {
      const swipeDistance = touchEndX - touchStartX;
      if (Math.abs(swipeDistance) > 50) {
        if (swipeDistance > 0) {
          let next = currentIndex - 1;
          if (next < 0) next = totalImages - 1;
          showImage(next);
        } else {
          let next = (currentIndex + 1) % totalImages;
          showImage(next);
        }
      }
    }

    prevBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      let next = currentIndex - 1;
      if (next < 0) next = totalImages - 1;
      showImage(next);
    });

    nextBtn?.addEventListener("click", (e) => {
      e.preventDefault();
      let next = (currentIndex + 1) % totalImages;
      showImage(next);
    });

    gsap.to(".about-header", {
      scrollTrigger: {
        trigger: "#about",
        start: "top 85%",
        toggleActions: "play none none none",
      },
      opacity: 1,
      y: 0,
      duration: 1,
      ease: "power3.out",
    });

    gsap.to(".about-image", {
      scrollTrigger: {
        trigger: "#about",
        start: "top 75%",
        toggleActions: "play none none none",
      },
      opacity: 1,
      x: 0,
      duration: 1,
      ease: "power3.out",
    });

    gsap.to(".about-text", {
      scrollTrigger: {
        trigger: "#about",
        start: "top 75%",
        toggleActions: "play none none none",
      },
      opacity: 1,
      x: 0,
      duration: 1,
      ease: "power3.out",
    });

    gsap.to(".github-stats", {
      scrollTrigger: {
        trigger: ".github-stats",
        start: "top 90%",
        toggleActions: "play none none none",
      },
      opacity: 1,
      y: 0,
      duration: 1,
      delay: 0.5,
      ease: "power3.out",
    });
  });
</script>
