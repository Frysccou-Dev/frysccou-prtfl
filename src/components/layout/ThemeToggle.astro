---
import { Sun, Moon } from "lucide-astro";
---

<button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
  <Sun size={16} class="icon sun-icon" />
  <Moon size={16} class="icon moon-icon" />
</button>

<style>
  .theme-toggle {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: transparent;
    border: 1px dotted #9fbdda;
    cursor: pointer;
    z-index: 100;
    transition: all 0.3s ease;
  }

  .theme-toggle:hover {
    background: rgba(159, 189, 218, 0.1);
    transform: scale(1.1);
  }

  .theme-toggle :global(.icon) {
    color: #9fbdda;
    transition: all 0.3s ease;
    position: absolute;
  }

  .theme-toggle :global(.sun-icon) {
    opacity: 1;
    transform: rotate(0deg);
  }

  .theme-toggle :global(.moon-icon) {
    opacity: 0;
    transform: rotate(-90deg);
  }

  :global(.dark) .theme-toggle :global(.sun-icon) {
    opacity: 0;
    transform: rotate(90deg);
  }

  :global(.dark) .theme-toggle :global(.moon-icon) {
    opacity: 1;
    transform: rotate(0deg);
  }
</style>

<script is:inline>
  (function () {
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "dark") {
      document.documentElement.classList.add("dark");
    }
  })();
</script>

<script>
  function setupThemeToggle() {
    const toggle = document.getElementById("themeToggle");
    if (!toggle) return;

    toggle.replaceWith(toggle.cloneNode(true));
    const newToggle = document.getElementById("themeToggle");

    newToggle?.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      const isDark = document.documentElement.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  }

  setupThemeToggle();
  document.addEventListener("astro:page-load", setupThemeToggle);
</script>
