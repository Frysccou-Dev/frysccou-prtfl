---
import { Menu } from "lucide-astro";
import { en } from "../../utils/translations/en";
import { es } from "../../utils/translations/es";
import { pt } from "../../utils/translations/pt";

interface Props {
  lang?: "en" | "es" | "pt";
}

const { lang = "en" } = Astro.props;

const translations = { en, es, pt };
const t = translations[lang];

const getProjectUrl = (projectId: string) => {
  if (lang === "en") return `/project/${projectId}`;
  return `/${lang}/project/${projectId}`;
};
---

<section class="projects-section" id="projects">
  <div class="section-header">
    <Menu size={16} class="header-icon" />
    <h3>{t.sections.selectedWorks}</h3>
  </div>

  <div class="projects-grid">
    {
      t.projects.map((project, index) => {
        const rowPosition = index % 3;
        const isFullWidth = rowPosition === 0;

        if (isFullWidth) {
          return (
            <div class="grid-row full">
              <a
                href={getProjectUrl(project.id)}
                class="project-card project-link"
                transition:name={`project-${project.id}`}
              >
                <div class="project-left">
                  <span class="project-year">{project.year}</span>
                  <div class="title-wrapper">
                    <span class="project-title">{project.title}</span>
                    {project.isNew && <span class="new-badge">NEW</span>}
                  </div>
                </div>
                <div class="project-right">
                  {project.tech.slice(0, 4).map((tech) => (
                    <span class="tech-pill">{tech}</span>
                  ))}
                </div>
              </a>
            </div>
          );
        } else if (rowPosition === 1) {
          const nextProject = t.projects[index + 1];
          return (
            <div class="grid-row half">
              <a
                href={getProjectUrl(project.id)}
                class="project-card project-link"
                transition:name={`project-${project.id}`}
              >
                <div class="project-left">
                  <span class="project-year">{project.year}</span>
                  <div class="title-wrapper">
                    <span class="project-title">{project.title}</span>
                    {project.isNew && <span class="new-badge">NEW</span>}
                  </div>
                </div>
                <div class="project-right">
                  {project.tech.slice(0, 3).map((tech) => (
                    <span class="tech-pill">{tech}</span>
                  ))}
                </div>
              </a>
              {nextProject && (
                <a
                  href={getProjectUrl(nextProject.id)}
                  class="project-card project-link"
                  transition:name={`project-${nextProject.id}`}
                >
                  <div class="project-left">
                    <span class="project-year">{nextProject.year}</span>
                    <div class="title-wrapper">
                      <span class="project-title">{nextProject.title}</span>
                      {nextProject.isNew && <span class="new-badge">NEW</span>}
                    </div>
                  </div>
                  <div class="project-right">
                    {nextProject.tech.slice(0, 3).map((tech) => (
                      <span class="tech-pill">{tech}</span>
                    ))}
                  </div>
                </a>
              )}
            </div>
          );
        }
        return null;
      })
    }
  </div>
</section>

<style>
  .projects-section {
    padding: 4rem 3rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }

  .section-header :global(.header-icon) {
    color: #9fbdda;
  }

  .section-header h3 {
    font-family: "Magna", sans-serif;
    font-size: 1rem;
    color: #9fbdda;
    margin: 0;
  }

  .projects-grid {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .grid-row {
    display: flex;
    gap: 1rem;
  }

  .grid-row.full .project-card {
    width: 100%;
  }

  .grid-row.half .project-card {
    width: 50%;
  }

  .project-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.5rem;
    background: transparent;
    border: 2px solid rgba(159, 189, 218, 0.3);
    border-radius: 15px;
    transition: all 0.3s ease;
    cursor: pointer;
    text-decoration: none;
    position: relative;
  }

  @media (min-width: 769px) {
    .project-card::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 17px;
      border: 2px dotted #9fbdda;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    .project-card::after {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 17px;
      border: 2px solid rgba(159, 189, 218, 0.3);
      transition: opacity 0.4s ease;
      pointer-events: none;
    }

    .project-card:hover::before {
      opacity: 1;
      animation: borderDash 12s linear infinite;
    }

    .project-card:hover::after {
      opacity: 0;
    }

    .project-card:hover {
      background: rgba(159, 189, 218, 0.08);
      border-color: transparent;
      transform: translateY(-2px);
    }

    @keyframes borderDash {
      0% {
        stroke-dashoffset: 0;
      }
      100% {
        stroke-dashoffset: 1000;
      }
    }
  }

  .project-card:hover {
    background: rgba(159, 189, 218, 0.08);
    border-color: rgba(159, 189, 218, 0.6);
    transform: translateY(-2px);
  }

  .project-left {
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .project-year {
    font-family: "Magna", sans-serif;
    font-size: 0.9rem;
    color: #9fbdda;
    opacity: 0.7;
  }

  .project-title {
    font-family: "Format", sans-serif;
    font-size: 1.1rem;
    color: #9fbdda;
  }

  .title-wrapper {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .new-badge {
    background: #9fbdda;
    color: #0c1214;
    font-family: "Magna", sans-serif;
    font-size: 0.6rem;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    font-weight: bold;
    letter-spacing: 0.05em;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0.6;
    }
    100% {
      opacity: 1;
    }
  }

  .project-right {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: flex-end;
  }

  .tech-pill {
    font-family: "Magna", sans-serif;
    font-size: 0.7rem;
    color: #9fbdda;
    background: transparent;
    border: 1px solid #9fbdda;
    padding: 0.3rem 0.75rem;
    border-radius: 50px;
  }

  @media (max-width: 768px) {
    .projects-section {
      padding: 3rem 1.5rem;
    }

    .grid-row.half {
      flex-direction: column;
    }

    .grid-row.half .project-card {
      width: 100%;
    }

    .project-card {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .project-right {
      justify-content: flex-start;
    }
  }
</style>

<script>
  const MIN_LOADER_DURATION = 1200;

  function initProjectLinks() {
    const projectLinks = document.querySelectorAll(".project-link");

    projectLinks.forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const href = link.getAttribute("href");
        if (!href) return;

        const loader = document.getElementById("pageLoader");
        if (loader) {
          loader.classList.remove("exit");
          loader.classList.add("enter");
        }

        setTimeout(() => {
          window.location.href = href;
        }, MIN_LOADER_DURATION);
      });
    });
  }

  initProjectLinks();
  document.addEventListener("astro:page-load", initProjectLinks);
</script>
